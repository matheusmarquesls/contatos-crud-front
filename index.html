<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h2>Contatos</h2>

    <input placeholder="nome" type="text" id="input_nome">
    <input placeholder="telefone" type="text" id="input_telefone">
    <input placeholder="email" type="text" id="input_email">

    <button onclick="adicionar()">Adicionar</button>

    <div id="div_usuarios"></div>

    <script>
    window.addEventListener('load', () => buscarUsuarios());

        function buscarUsuarios(){
        fetch('http://localhost:3000/contatos').then((response) =>{
            
            console.log(response);

            return response.json();

        }).then((data) =>{
            console.log(data);

            div_usuarios.innerHTML = "";

            data.forEach((contact)=>{
                div_usuarios.innerHTML += `
                <div>
                Nome: ${contact.nome} |
                Email: ${contact.email} |
                telefone: ${contact.telefone}
                </div>
                <button onclick="editar('${contact.id}')">‚úèÔ∏è</button>
                <button onclick="deletar('${contact.id}')">üóëÔ∏è</button>
                `;
            });

        }).catch((err)=>{
            console.log("Houve um erro durante a requisi√ß√£o");
            console.log(err);
        });        
    }
        
        function adicionar(){
            const nome = document.getElementById('input_nome').value;
            const telefone = document.getElementById('input_telefone').value;
            const email = document.getElementById('input_email').value;
        
            const novoUsuario = {
                nome,
                telefone,
                email
            };
        
            console.log(novoUsuario);

            fetch('http://localhost:3000/contatos', {
                method: 'POST',
                body:JSON.stringify(novoUsuario)
            }).then((res) => {
                console.log("usu√°rio adicionado com sucesso");

                buscarUsuarios()
            }).catch(err => {
                console.log(err);
            });
        }

        function deletar(id){
            if(!id){
                return console.error("N√£o h√° id v√°lido para editar")
            }

            const nome = document.getElementById('input_nome').value;
            const telefone = document.getElementById('input_telefone').value;
            const email = document.getElementById('input_email').value;
        
            const novoUsuario = {
                nome,
                telefone,
                email
            };

            fetch(`http://localhost:3000/contatos/${id}`, 
                {
                    method:"PUT",
                    body:JSON.stringify(novoUsuario)
                }
            ).then(res => {
                console.log('res', res);
                console.log("usu√°rio editado");
                buscarUsuarios();
            });

            function deletar(id){
            if(!id){
                return console.error("N√£o h√° id v√°lido para deletar")
            }

            const nome = document.getElementById('input_nome').value;
            const telefone = document.getElementById('input_telefone').value;
            const email = document.getElementById('input_email').value;
        
            const novoUsuario = {
                nome,
                telefone,
                email
            };

            fetch(`http://localhost:3000/contatos/${id}`, 
                {
                    method:"DELETE",
                    body:JSON.stringify(novoUsuario)
                }
            ).then(res => {
                console.log('res', res);
                console.log("usu√°rio deletado");
                buscarUsuarios();
            });
        }
    }
        </script>
</body>
</html>